From 41251a95a6736470902c75d72ef423670689faa6 Mon Sep 17 00:00:00 2001
From: Nikita Yushchenko <nikita.yoush@cogentembedded.com>
Date: Sat, 13 May 2023 22:48:39 +0600
Subject: [PATCH 69/85] arm64: dts: renesas: vc4: add rswitch device

Signed-off-by: Nikita Yushchenko <nikita.yoush@cogentembedded.com>
---
 arch/arm64/boot/dts/renesas/r8a779f0-vc4.dts | 135 +++++++++++++++++++
 1 file changed, 135 insertions(+)

diff --git a/arch/arm64/boot/dts/renesas/r8a779f0-vc4.dts b/arch/arm64/boot/dts/renesas/r8a779f0-vc4.dts
index b7b522b5ea17..3bd676ec61de 100644
--- a/arch/arm64/boot/dts/renesas/r8a779f0-vc4.dts
+++ b/arch/arm64/boot/dts/renesas/r8a779f0-vc4.dts
@@ -158,6 +158,25 @@ eeprom@50 {
 
 		label = "board-data";
 		pagesize = <8>;
+
+		#address-cells = <1>;
+		#size-cells = <1>;
+
+		rswitch2_gw_mac: rsw2gwmac@720 {
+			reg = <0x720 0x06>;
+		};
+
+		rswitch2_port0_mac: rsw2p0mac@728 {
+			reg = <0x728 0x06>;
+		};
+
+		rswitch2_port1_mac: rsw2p1mac@730 {
+			reg = <0x730 0x06>;
+		};
+
+		rswitch2_port2_mac: rsw2p2mac@738 {
+			reg = <0x738 0x06>;
+		};
 	};
 
 	fpga4000: fpga4000@71 {
@@ -239,6 +258,23 @@ qspi1 {
 		};
 	};
 
+	rswitch_pins: rswitch {
+		tsn0_mdio {
+			groups = "tsn0_mdio";
+			function = "tsn0";
+		};
+
+		tsn1_mdio {
+			groups = "tsn1_mdio";
+			function = "tsn1";
+		};
+
+		tsn2_mdio {
+			groups = "tsn2_mdio";
+			function = "tsn2";
+		};
+	};
+
 	scif0_pins: scif0 {
 		groups = "scif0_data", "scif0_ctrl";
 		function = "scif0";
@@ -349,6 +385,105 @@ space3@1100000 {
 	};
 };
 
+&rswitch {
+	compatible = "renesas,rswitch2-r8a779f0", "renesas,rswitch2";
+	status = "okay";
+
+	pinctrl-0 = <&rswitch_pins>;
+	pinctrl-names = "default";
+
+	/* normally gateway port MAC address comes from EEPROM ... */
+	nvmem-cells = <&rswitch2_gw_mac>;
+	nvmem-cell-names = "mac-address";
+	/* ... but EEPROM setting could be overridden */
+	mac-address = [00 00 00 00 00 00];
+
+	ports {
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		port@0 {
+			reg = <0>;
+
+			/* normally port MAC address comes from EEPROM ... */
+			nvmem-cells = <&rswitch2_port0_mac>;
+			nvmem-cell-names = "mac-address";
+			/* ... but EEPROM setting could be overridden */
+			mac-address = [00 00 00 00 00 00];
+
+			/* phy-mode = "usxgmii"; */
+			/* phy-handle = <&tsn0_phy_2g5>; */
+			phy-mode = "sgmii";
+			phy-handle = <&tsn0_phy_1g>;
+			#address-cells = <1>;
+			#size-cells = <0>;
+			tsn0_phy_2g5: ethernet-phy@0 {
+				reg = <0>;
+				compatible = "ethernet-phy-ieee802.3-c45";
+				status = "disabled";
+			};
+			tsn0_phy_1g: ethernet-phy@3 {
+				reg = <3>;
+				compatible = "ethernet-phy-ieee802.3-c45";
+				status = "okay";
+			};
+		};
+
+		port@1 {
+			reg = <1>;
+
+			/* normally port MAC address comes from EEPROM ... */
+			nvmem-cells = <&rswitch2_port1_mac>;
+			nvmem-cell-names = "mac-address";
+			/* ... but EEPROM setting could be overridden */
+			mac-address = [00 00 00 00 00 00];
+
+			/* phy-mode = "usxgmii"; */
+			/* phy-handle = <&tsn1_phy_2g5>; */
+			phy-mode = "sgmii";
+			phy-handle = <&tsn1_phy_1g>;
+			#address-cells = <1>;
+			#size-cells = <0>;
+			tsn1_phy_2g5: ethernet-phy@0 {
+				reg = <0>;
+				compatible = "ethernet-phy-ieee802.3-c45";
+				status = "disabled";
+			};
+			tsn1_phy_1g: ethernet-phy@3 {
+				reg = <3>;
+				compatible = "ethernet-phy-ieee802.3-c45";
+				status = "okay";
+			};
+		};
+
+		port@2 {
+			reg = <2>;
+
+			/* normally port MAC address comes from EEPROM ... */
+			nvmem-cells = <&rswitch2_port2_mac>;
+			nvmem-cell-names = "mac-address";
+			/* ... but EEPROM setting could be overridden */
+			mac-address = [00 00 00 00 00 00];
+
+			phy-mode = "sgmii";
+			/* phy-handle = <&tsn2_phy_1g_rh>; */
+			phy-handle = <&tsn2_phy_1g>;
+			#address-cells = <1>;
+			#size-cells = <0>;
+			tsn2_phy_1g_rh: ethernet-phy@1 {
+				reg = <1>;
+				compatible = "ethernet-phy-ieee802.3-c45";
+				status = "disabled";
+			};
+			tsn2_phy_1g: ethernet-phy@3 {
+				reg = <3>;
+				compatible = "ethernet-phy-ieee802.3-c45";
+				status = "okay";
+			};
+		};
+	};
+};
+
 &rwdt {
 	status = "disabled";
 
-- 
2.39.2

