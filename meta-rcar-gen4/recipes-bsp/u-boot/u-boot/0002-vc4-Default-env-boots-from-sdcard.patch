From 67f5bb8c7e807065e94bf3aadb323f7a440d632d Mon Sep 17 00:00:00 2001
From: Vito Colagiacomo <vito.colagiacomo@renesas.com>
Date: Tue, 4 Jan 2022 16:46:25 +0100
Subject: [PATCH] vc4: Default env boots from sdcard

---
 configs/r8a779f0_vc4_defconfig | 2 +-
 include/configs/vc4.h          | 6 ++++++
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/configs/r8a779f0_vc4_defconfig b/configs/r8a779f0_vc4_defconfig
index c3ed921ff1..ba38afde15 100644
--- a/configs/r8a779f0_vc4_defconfig
+++ b/configs/r8a779f0_vc4_defconfig
@@ -14,7 +14,7 @@ CONFIG_DEFAULT_DEVICE_TREE="r8a779f0-vc4-u-boot"
 CONFIG_FIT=y
 CONFIG_SUPPORT_RAW_INITRD=y
 CONFIG_USE_BOOTARGS=y
-CONFIG_BOOTARGS="root=/dev/nfs rw nfsroot=192.168.0.1:/export/rfs ip=192.168.0.20"
+CONFIG_BOOTARGS="root=/dev/mmcblk0p1 rw rootfstype=ext4 rootwait"
 CONFIG_DEFAULT_FDT_FILE="r8a779f0-vc4.dtb"
 CONFIG_HUSH_PARSER=y
 CONFIG_CMD_BOOTZ=y
diff --git a/include/configs/vc4.h b/include/configs/vc4.h
index 32a1edec20..e678069dc9 100644
--- a/include/configs/vc4.h
+++ b/include/configs/vc4.h
@@ -18,4 +18,10 @@
 /* Generic Timer Definitions (use in assembler source) */
 #define COUNTER_FREQUENCY	0x1312D00	/* 20.00MHz from CPclk */
 
+#undef CONFIG_BOOTCOMMAND
+#define CONFIG_BOOTCOMMAND	  \
+	"ext4load mmc 0:1 0x48080000 /boot/Image; " \
+	"ext4load mmc 0:1 0x48000000 /boot/"CONFIG_DEFAULT_FDT_FILE"; " \
+	"booti 0x48080000 - 0x48000000"
+
 #endif /* __VC4_H */
-- 
2.17.1

